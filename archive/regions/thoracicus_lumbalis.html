<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Грудной отдел позвоночника</title>
  <link rel="stylesheet" type="text/css" href="../view.css" media="all">
  <script type="text/javascript" src="../view.js"></script>
  <!-- <link rel="stylesheet" type="text/css" href="msfmultiselect.css" /> -->
  <!-- <script src="msfmultiselect.js"></script> -->
  <!-- <script type="text/javascript" src="autorep.js"></script> -->
  <!-- <script type="text/javascript" src="jquery-2.1.3.min.js"></script> -->

  <script>
    function testVariable() {
      debugger


      // ВЫБОР ИЗ СПИСКА
      // let result_list = [];
      // if (document.getElementById("list").length > 0) {
      //   for (let i = 0; i < document.getElementById("list").length; i++) {
      //     let option = document.getElementById("list").options[i];
      //     if (option.selected) {
      //       result_list = option.value;
      //     }
      //   }
      // }


      const proekcia = "На рентгенограммах грудного отдела позвоночника в двух проекциях";
      let os = "ось ";
      let osSide = "вправо";
      let lord = "Физиологический грудной кифоз ";
      let min = "Минеральная плотность позвонков ";
      let vysota = "Высота тел позвонков ";
      const rg = 'рентген-признаки'; // используется только в условиях
      const dg = 'дегенеративно-дистрофических изменений шейного отдела позвоночника' // используется только в условиях
      const dgNachalnye = 'начальных дегенеративно-дистрофических изменений шейного отдела позвоночника' // используется только в условиях
      const zamykat = 'замыкательные пластинки тел позвонков';
      let disc = "Высота межпозвонковых дисков ";
      let scler = ""; 
      let kraevye = "";
      let ost = "";
      let dug = "Дугоотростчатые суставы без особенностей";
      let conditionals = "";
      let additionals = "";
      let conclusion = "Заключение: ";
      let conclusionSkol = "";
      let conclusionPathology = "рентген-признаков патологических изменений не выявлено";
      let flagForconclusionPathology;
      let conclusionLord = "";
      let conclusionVysota = "";
      let commaForConclusion = ""
      let commaForConclusion2 = ""
      const space = " ";
      const dot = ". ";
      const comma = ", ";
      let skobka = "";
      let skobkaEnd = "";
      let degDist = "";
      let nachDegDist = "";
      let osteoh = "";
      let spondilez = "";
      let spondiloartroz = "";
      let partThoracicus;
      let partLumbalis;
      let abz = String.fromCharCode(13, 10);
      let abzForConditionals = String.fromCharCode(13, 10);
      let abzForAdditionals = String.fromCharCode(13, 10);



      const conditionalsList = {
        шум: "Повышенный шум на изображениях. ",
        дин: "Динамические артефакты. ",
        мет: "Артефакт металлической плотности. "
      };
      const additionalsList = {
        сос: "Обызвествление аорты. ",
        плот: "Плотная тень размерами 11х15мм в проекции ... - артефакт? "
      };
      // const osList = {
      //   отк: `умеренно отклонена ${osSide}`,
      //   скол: `С-образно сколиотически искривлена ${osSide} без ротации тел позвонков. Угол вершиной на уровне Th8 5,5гр. На высоте искривления определяется минимальное снижение высоты противоположных отделов межпозвонковых дисков`,
      // };

      // УСЛОВИЯ
      conditionals += autoreplace(conditionalsList);
    
      // ДОПОЛНЕНИЯ
      additionals += autoreplace(additionalsList);

      // УБИРАЕТ АБЗАЦ ЕСЛИ НЕТ УСЛОВИЙ И ДОПОЛНЕНИЙ
      if (conditionals == "") {
        abzForConditionals = "";
      }
      if (additionals == "") {
        abzForAdditionals = "";
      }


      // ОТКЛОНЕНИЕ ОСИ СКОЛИЗ
      if (pole.value.includes('лев')) {
        osSide = "влево";
      }

      if (pole.value.includes('отк')) {
        os += `умеренно отклонена ${osSide}`
      } else if (pole.value.includes('скол')) {
        os += `С-образно сколиотически искривлена ${osSide} без ротации тел позвонков. Угол вершиной на уровне Th8 5,5гр. На высоте искривления определяется минимальное снижение высоты противоположных отделов межпозвонковых дисков`
        conclusionSkol = space + "С-образной сколиотической деформации грудного отдела позвоночника I степени (по В.Д. Чаклину)"
        conclusionPathology = rg;
      } else {
        os += "не отклонена"
      }

      // ЛОРДОЗ КИФОЗ
      if (pole.value.includes('вып')) {
        lord += "выпрямлен";
        conclusionLord = true;
        flagForconclusionPathology = true;
      } else if (pole.value.includes('сгл')) {
        lord += "сглажен";
        conclusionLord = true;
        flagForconclusionPathology = true;
      } else if (pole.value.includes('усил')) {
        lord += "усилен";
        conclusionLord = true;
        flagForconclusionPathology = true;
      } else {
        lord += "сохранён";
      }
      if (conclusionLord) {
        conclusionLord = space + "с нарушением статики";
      }


      // МИНЕРАЛЬНАЯ ПЛОТНОСТЬ
      if (pole.value.includes('мин')) {
        min += "снижена";
      } else {
        min += "сохранена";
      }


      // ВЫСОТА ТЕЛ ПОЗВОНКОВ
      if (pole.value.includes('сниж')) {
        vysota += "Th3, Th4,Th5, Th6, Th7, Th8, Th9, Th10, Th11, Th12 снижена по передней поверхности до 1/4";
        conclusionVysota = space + "мягкой клиновидной деформации тел позвонков Th3, Th4,Th5, Th6, Th7, Th8, Th9, Th10, Th11, Th12";
        flagForconclusionPathology = true;
      } else {
        vysota += "не снижена";
      }


      // ПЕРЕКЛЮЧАТЕЛЬ ЗАКЛЮЧЕНИЯ НА РЕНТГЕН-ПРИЗНАКИ
      if (flagForconclusionPathology) {
        conclusionPathology = rg;
      }


      // ВЫСОТА МЕЖПОЗВОНКОВЫХ ДИСКОВ
      if (pole.value.includes('3-7')) {
        disc += "снижена в сегменте(-ах): Th3-Th4, Th4-Th5, Th5-Th6, Th6-Th7";
      } else if (pole.value.includes('3-12')) {
        disc += "снижена в сегменте(-ах): Th3-Th4, Th4-Th5, Th5-Th6, Th6-Th7, Th7-Th8, Th8-Th9, Th9-Th10, Th10-Th11, Th11-Th12";
      } else {
        disc += "не снижена";
      }


      // СУБХОНДРАЛЬНЫЙ СКЛЕРОЗ
      if (pole.value.includes('суб')) {
        scler = comma + "субхондральный склероз тел позвонков";
        osteoh = "остеохондроз" + comma;
        degDist = true;
      } else if (pole.value.includes('упл')) {
        scler = comma + "уплотнены " + zamykat;
        osteoh = "остеохондроз" + comma;
        degDist = true;
      } else if (pole.value.includes('подч')) {
        scler = comma + "подчёркнуты " + zamykat;
        nachDegDist = true;
      }


      // СПОНДИЛОФИТЫ
      if (pole.value.includes('спонд')) {
        kraevye = comma + "спондилофиты по задним и по передним поверхностям тел позвонков";
      } else if (pole.value.includes('скоб')) {
        kraevye = comma + "спондилофиты по задним и скобкообразного характера по переднебоковым поверхностям тел позвонков";
        spondilez = "спондилёз" + comma;
        degDist = true;
      }

    
      // ИЗМЕНЕНИЯ В ОСТАЛЬНЫХ ОТДЕЛАХ
      if (pole.value.includes('ост')) {
        ost = "Изменения в остальных отделах менее выражены" + dot;
      }


      // ДУГООТРОСТЧАТЫЕ СУСТАВЫ
      if (pole.value.includes('дугуп')) {
        dug = "Уплотнены суставные поверхности дугоотростчатых суставов";
        spondiloartroz = "спондилоартроз" + comma;
        degDist = true;
      } else if (pole.value.includes('дугпо')) {
        dug = "Подчёркнуты суставные поверхности дугоотростчатых суставов";
        nachDegDist = true;
      } else if (pole.value.includes('дуг')) {
        dug = "Уплотнены суставные поверхности и неравномерно снижена высота рентгеновской суставной щели дугоотростчатых суставов";
        spondiloartroz = "спондилоартроз" + comma;
        degDist = true;
      }


      // ЗАКЛЮЧЕНИЕ
      if (nachDegDist) {
        conclusionPathology = rg + space + dgNachalnye;
      }
      if (degDist) {
        skobka = space + "(";
        conclusionPathology = rg + space + dg;
      }

      if (pole.value.includes('выр')) {
        conclusionPathology = rg + space + "выраженных" + space + dg;
      } else if (pole.value.includes('уме')) {
        conclusionPathology = rg + space + "умеренных" + space + dg;
      }

      conclusionOsteoh = skobka + (osteoh + spondilez + spondiloartroz).replace(/,(?![^,]*,)/m, ')').trim();

      if (conclusionVysota && conclusionSkol) {
          commaForConclusion2 = ",";
        }

      if (degDist || nachDegDist || conclusionLord) {
        if (conclusionSkol || conclusionVysota) {
          commaForConclusion = ",";
        }
      }

      conclusion += conclusionPathology + conclusionOsteoh + conclusionLord + commaForConclusion + conclusionSkol + commaForConclusion2 + conclusionVysota;


      let partTest =`${conditionals}${abzForConditionals}${proekcia} ${os}.${abz}${lord}.${abz}${vysota}.${abz}${min}.${abz}${disc}${scler}${kraevye}.${ost}${abz}${dug}.${abz}${additionals}${abzForAdditionals}${conclusion}.${abz}`



      partThoracicus = conditionals + abzForConditionals + proekcia + space + os + dot + abz + lord + dot + abz + vysota + dot + abz + min + dot + abz + disc + scler + kraevye + dot + ost + abz + dug + dot + abz + additionals + abzForAdditionals + conclusion + dot;

      partLumbalis = conditionals + abzForConditionals + proekcia + space + os + dot + abz + lord + dot + abz + vysota + dot + abz + min + dot + abz + disc + scler + kraevye + dot + ost + abz + dug + dot + abz + additionals + abzForAdditionals + conclusion + dot;


      document.getElementById("show").value = 
      partTest
      + abz
      + partThoracicus
      + abz
      + abz
      + partLumbalis;


    // document.getElementById("show").innerText = result_list;      
    // pro_okno = document.getElementById("pro").innerHTML;


    let input = document.getElementById("pole");
    input.addEventListener("keypress", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();
        document.getElementById("saveForm").click();
      }
    });

    let input2 = document.getElementById("pole2");
    input2.addEventListener("keypress", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();
        document.getElementById("saveForm").click();
      }
    });

    }


    function autoreplace(list) {
      let result = "";
      for (let key in list) {
        if (pole2.value.includes(key)) {
          result += list[key];
        }
      }
      return result;
    }



    // ПЕРЕБОР ОБЪЕКТА С КЛЮЧАМИ И ЗНАЧЕНИЯМИ, ПОВТОРЯЮЩИЙСЯ КОД ДЛЯ КАЖДОГО СПИСКА
    // for (let key in conditionalsList) {
    //   if (pole2.value.includes(key)) {
    //     conditionals += conditionalsList[key];
    //   }
    // }

    // ВЫЗОВ ФУНКЦИИ С АРГУМЕНТАМИ, ПОВТОРЯЮЩИЙСЯ КОД ДЛЯ КАЖДОЙ ФРАЗЫ
    // // conditionals += autoreplace('шум', "Повышенный шум на изображениях. ");
    
    // // ФУНКЦИЯ С ПАРАМЕТРАМИ, ПОВТОРЯЮЩИЙСЯ КОД ДЛЯ КАЖДОЙ ФРАЗЫ
    // function autoreplace(word, conditional) { 
    //     if (pole2.value.includes(word)) {
    //     return conditional;
    //     } else {
    //       return "";
    //     }
    //   }


    function copy_to_clipboard(show) {
      document.getElementById(show).select();
      document.execCommand('copy');
    }


  </script>


</head>



<body id="main_body">



  <div id="form_container">


    <!-- ВЫБОР ИЗ СПИСКА -->
    <!-- 
     <div id="form_item_1">

      <form id="form_48871" class="appnitro" method="post" action="">
        <div class="form_description">
          <h2>Шейный отдел позвоночника</h2>
          <p>
            description
          </p>
        </div>

        <div class="my_container">
          
          <div class="my_card">
            <select class="form-control" id="list" name="list" multiple>
               <option disabled>------------------ОСЬ</option>
              <option value="os_um_otklonena">умеренно отклонена</option>
            </select>
          </div>
        </div>


      </form>


    </div> 
  -->


<!-- СОКРАЩЕНИЯ -->
    <div class="mydivh1">
      <ul class="my_ul">
        <li>отк</li>
        <li>скол</li>
        <li>лев</li>
        <li>вып</li>
        <li>сгл</li>
        <li>мин</li>
        <li>3-7</li>
        <li>3-12</li>
        <li>суб</li>
        <li>упл</li>
        <li>подч</li>
        <li>спонд</li>
        <li>скоб</li>
        <li>ост</li>
        <li>дугуп</li>
        <li>дугпо</li>
        <li>дуг</li>
        <li>выр</li>
        <li>уме</li>
        <li>шум</li>
        <li>дин</li>
        <li>мет</li>
        <li>арт</li>
        <li>хир</li>
        <li>сос</li>
        <li>плот</li>
      </ul>
    </div>


<!-- МЕНЮ -->
    <div id="form_item_2">

      <div class="page">
        <nav class="page__menu menu">
          <ul class="menu__list r-list">
            <li class="menu__group"><a href="chest.html" class="menu__link r-link text-underlined">ОГК</a></li>
            <li class="menu__group"><a href="knee.html" class="menu__link r-link text-underlined">КОЛ</a></li>
            <li class="menu__group"><a href="ankle.html" class="menu__link r-link text-underlined">ГОЛ</a></li>
            <li class="menu__group"><a href="hip.html" class="menu__link r-link text-underlined">ТБС</a></li>
            <li class="menu__group"><a href="wrist.html" class="menu__link r-link text-underlined">ЛУЧ</a></li>
            <li class="menu__group"><a href="shoulder.html" class="menu__link r-link text-underlined">ПЛЕЧ</a></li>
          </ul>

          <ul class="menu__list r-list">
            <li class="menu__group"><a href="cervicalis.html" class="menu__link r-link text-underlined">ШОП</a></li>
            <li class="menu__group"><a href="thoracicus.html" class="menu__link r-link text-underlined">ГОП</a></li>
            <li class="menu__group"><a href="lumbalis.html" class="menu__link r-link text-underlined">ПОП</a></li>
            <li class="menu__group"><a href="thoracicus_lumbalis.html" class="menu__link">ГПОП</a></li>
            <li class="menu__group"><a href="hand.html" class="menu__link r-link text-underlined">КИСТЬ</a></li>
          </ul>
        </nav>
      </div>
      <br>


      <!-- ТЕКСТОВАЯ ОБЛАСТЬ С ВЫВОДОМ ПРОТОКОЛА -->
      <textarea variable="yname" id="show" class="mytextarea" rows="18" cols="90"></textarea><br>

      <!-- ПОЛЕ ВВОДА -->
      <input class="pole" id="pole" /><br>
      <input class="pole" id="pole2" />

      <!-- КНОПКИ -->
      <li class="buttons">
        <input id="saveForm" class="my_btn-new" type="submit" name="submit" value="Вывод" onclick="testVariable()" />
        <input type="button" class="my_btn-new" value="Скопировать" onclick="copy_to_clipboard('show');">
      </li>



    </div>


  </div>


</body>




<!-- MSFmultiSelect -->
<script>

  // var list = new MSFmultiSelect(
  //   document.querySelector('#list'),
  //   {
  //     theme: 'theme2',
  //     selectAll: true,
  //     searchBox: true,
  //     width: '500px',
  //     height: '80px',
  //     // readOnly: true,
  //     onChange: function (checked, value, instance) {
  //       console.log(checked, value, instance);
  //     },
  //     // appendTo: '#myselect',
  //     autoHide: true
  //   }
  // )



</script>





</html>